<!DOCTYPE html> 
<html> 
    <head> 
        <meta charset="utf-8">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
        <link rel="stylesheet" href="../www/css/main.css">
        <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
        <script src="../www/openseadragon/openseadragon.min.js"></script>
    </head> 
<body> 

<div data-role="page" id="home">
  <div data-role="header">
    <h1>Loyola Map</h1>
  </div>

  <div id="mapContainer"> 
      <!-- Opeanseadragon div- necessary to show the map -->
      <div id="openseadragon1" style="width: 600px; height: 800px;"></div>  
          <script type="text/javascript">
          var viewerOpen = OpenSeadragon({
            id: "openseadragon1",
            prefixUrl: "../www/openseadragon/images/",
            tileSources: "../www/openseadragon/maplsc2/dzc_output_images/lsc.xml"
          });
          </script>
    </div>  

<!-- Temporary div to track the mouse position -->
    <div id="test"></div>


    <script type="text/javascript">
 
viewerOpen.addHandler('canvas-click', function(event) {

    // Temporary tracker for testing
        var tracker = new OpenSeadragon.MouseTracker({
                 element: viewerOpen.container,
                  moveHandler: function(event) {
                    var point = viewerOpen.viewport.pointFromPixel(event.position);
                    document.getElementById("test").innerHTML = '<br><br>Viewport:<br>' + point.toString() ;
        }});      
         tracker.setTracking(true);  
   // Temporary tracker end
   

            var webPoint = event.position;
            var viewportPoint = viewerOpen.viewport.pointFromPixel(webPoint);
            var imagePoint = viewerOpen.viewport.viewportToImageCoordinates(viewportPoint);
            var zoom = viewerOpen.viewport.getZoom(true);
            var imageZoom = viewerOpen.viewport.viewportToImageZoom(zoom);


        $.getJSON("data/buildings.json", function(data){

          $.each(data.buildings, function(i,item){
            
            // Verify if the clicked position is a building
            if ((viewportPoint.x< item.xmax && viewportPoint.x> item.xmin) && (viewportPoint.y<item.ymax && viewportPoint.y> item.ymin)) {
                // Open a new building as a dialog
                $(":mobile-pagecontainer").pagecontainer("change", "buildings.html", {
                  role:"dialog",
                  changeHash: false
                });
            
                $(document).on("pageshow", "#pagetwo", function( event ) {
                  $("#buildingName").html(item.name);
                  $("#buildingImages").html("<img id='buildingImg' src='"+ item.img + "''>");
                  $("#buildingDescription").html(item.description);
                });
          
              return false;
            }
          });
        });
});

</script>
</body>
</html>